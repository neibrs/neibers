id: ip_xls
label: IP(xls)
migration_tags: { }
source:
  plugin: xls
  header_row: 1
  path: modules/neibers/product/idc/tests/data/ip.xlsx
  sheet_name: Sheet1
  keys:
    - Name
  columns:
    0:
      Name: Name
    1:
      Type: Type
    2:
      Server: Server
    3:
      Cabinet: Cabinet
    4:
      Room: Room
    5:
      Client: Client
    6:
      Status: Status
    7:
      Changed: Changed
    8:
      ID: ID
    9:
      Seat: Seat
process:
  name:
    -
      plugin: skip_on_empty
      method: row
      source: Name
      message: 'IP name has not set'
    -
      plugin: get
  type:
    -
      plugin: skip_on_empty
      method: process
      source: Name
    -
      plugin: static_map
      source: Type
      map:
        管理IP: inet
        业务IP: onet
        交换机IP: snet
# TODO need to fix import field data.
  ip_room:
    -
      plugin: skip_on_empty
      method: process
      source: Name
    -
      plugin: entity_generate
      source: Room
      entity_type: room
      bundle_key: type
      bundle: default
      value_key: name
      ignore_case: true

  ip_cabinet:
    -
      plugin: skip_on_empty
      method: process
      source: Name
    -
      plugin: entity_generate_plus
      source: Cabinet
      entity_type: cabinet
      value_key: name
      ignore_case: true
      conditions:
        room: '@ip_room'
      values:
        room: '@ip_room'
  seat:
    -
      plugin: skip_on_empty
      method: process
      source: Name
    -
      plugin: entity_generate_plus
      source: Seat
      entity_type: seat
      value_key: name
      bundle_key: type
      bundle: default
      ignore_case: true
      conditions:
        cabinet: '@ip_cabinet'
      values:
        cabinet: '@ip_cabinet'
  server:
    - plugin: skip_on_empty
      method: process
      source: Name
    -
      plugin: entity_generate_plus
      source: Server
      entity_type: server
      bundle_key: type
      bundle: default
      value_key: name
      ignore_case: true
      conditions:
        seat: '@seat'
      values:
        seat: '@seat'
  state:
    plugin: default_value
    default_value: free #TODO delete

destination:
  plugin: entity:ip
